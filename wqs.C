#include "TFile.h"
#include "TROOT.h"
#include "TH1F.h"
#include "TString.h"
#include "TLegend.h"
#include <iostream>

void wqs(){
	//Luminositaeten
	double L[7];
	L[0]=675.8590;
	L[1]=543.6270;
	L[2]=419.7760;
	L[3]=3122.204;
	L[4]=639.8380;
	L[5]=479.2400;
	L[6]=766.8380;
	//Schwerpunktsenergien
	double S[7]={88.48021,89.47158,90.22720,91.23223,91.97109,92.97091,93.71841};
	
	//Eventnamen
	
	TString names[4]={"ee","mm","TT","qq"};
	//Anzahl Ereignisse nach Schnitt,
	//sortiert nach Schwerpunktsenergie
	TMatrixD N(4,7);
	//e-events
	N(0,0)=908;
	N(0,1)=823;
	N(0,2)=719;
	N(0,3)=6442;
	N(0,4)=981;
	N(0,5)=484;
	N(0,6)=713;
	//m-events
	N(1,0)=137;
	N(1,1)=242;
	N(1,2)=332;
	N(1,3)=3905;
	N(1,4)=691;
	N(1,5)=269;
	N(1,6)=329;
	//t-events
	N(2,0)=158;
	N(2,1)=222;
	N(2,2)=277;
	N(2,3)=3735;
	N(2,4)=619;
	N(2,5)=280;
	N(2,6)=303;
	//q-events
	N(3,0)=3528;
	N(3,1)=5322;
	N(3,2)=7542;
	N(3,3)=92764;
	N(3,4)=15294;
	N(3,5)=6643;
	N(3,6)=7419;
	//invertierte effizienzmatrizen
	double ineps_a[7][4][4]= {{{3.52474, 0.00094, -0.03787, -0.00122}, {-0.00063, 1.10920, -0.00736, 0.00000}, 
	{-0.01152, -0.02920, 1.08774, -0.00168}, {-0.00017, 0.00019, -0.00755, 1.01042}},
	{{3.09300, 0.00082, -0.03323, -0.00107}, {-0.00055, 1.10920, -0.00736, 0.00000}, 
	{-0.01011, -0.02920, 1.08772, -0.00168}, {-0.00015, 0.00019, -0.00755, 1.01042}},
	{{3.00005, 0.00080, -0.03223, -0.00104}, {-0.00053, 1.10920, -0.00736, 0.00000},
	{-0.00981, -0.02920, 1.08772, -0.00168}, {-0.00014, 0.00019, -0.00755, 1.01042}},
	{{2.93091, 0.00078, -0.03149, -0.00102}, {-0.00052, 1.10920, -0.00736, 0.00000},
	{-0.00958, -0.02920, 1.08772, -0.00168}, {-0.00014, 0.00019, -0.00755, 1.01042}},
	{{3.48839, 0.00093, -0.03747, -0.00121}, {-0.00062, 1.10920, -0.00736, 0.00000},
	{-0.01140, -0.02920, 1.08773, -0.00168}, {-0.00017, 0.00019, -0.00755, 1.01042}},
	{{4.47174, 0.00119, -0.04804, -0.00155}, {-0.00079, 1.10920, -0.00736, 0.00000},
	{-0.01462, -0.02921, 1.08777, -0.00168}, {-0.00021, 0.00019, -0.00755, 1.01042}},
	{{6.66751, 0.00178, -0.07163, -0.00231}, {-0.00118, 1.10920, -0.00736, 0.00000},
	{-0.02179, -0.02921, 1.08785, -0.00167}, {-0.00032, 0.00019, -0.00755, 1.01042}}};
	TMatrixD ineps(4,4);
	/*
	ineps(0,0)=2.055;
	ineps(0,1)=0.0005471;
	ineps(0,2)=-0.02207;
	ineps(0,3)=-0.0007133;
	ineps(1,0)=-0.0003647;
	ineps(1,1)=1.109;
	ineps(1,2)=-0.007366;
	ineps(1,3)=3.12e-007;
	ineps(2,0)=-0.006716;
	ineps(2,1)=-0.0292;
	ineps(2,2)=1.088;
	ineps(2,3)=-0.001679;
	ineps(3,0)=-9.872e-005;
	ineps(3,1)=0.0001915;
	ineps(3,2)=-0.007549;
	ineps(3,3)=1.01;
	*/
	//double cor00[7]={1,1,1,1,1,1,1};
	//Graphen
	TGraph dat[4];
	//Graphen Namen
	
	//tats√§chliche Ereignisse, Multiplikation mit ineps
	TMatrixD Nk(4,7);
	cout << "ineps"<<endl;
	ineps.Print();
	cout<< "Vor korrektur"<<endl;
	N.Print();
	Nk=ineps*N;
	double wq[7];
	cout << "Anzahl Ereignisse" << endl;
	for(int i=0; i<4;i++){
		for(int j=0; j<7;j++){
			//richtige inverse matrix benutzen
			for(int l=0; l<4;l++){
				for(int m=0; m<4; m++){
					ineps(l,m)=ineps_a[j][l][m];
					}
				}
			Nk=ineps*N;
			wq[j]=Nk(i,j)/L[j];
			cout << wq[j]<<endl;}
		dat[i]= new TGraph(7,S,wq);
		dat[i]->SetMarkerSize(1.5);
		dat[i]->SetMarkerStyle(21);
		TCanvas* c = new TCanvas("c", "c");
		dat[i]->Draw("AP");
		c->SaveAs("WQ "+names[i]+".png");
		c->Close();
		}
}